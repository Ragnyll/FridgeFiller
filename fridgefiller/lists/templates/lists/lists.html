{% extends "base_sidebar.html" %}

{% block title %}
  Your Shopping Lists
{% endblock %}

{% block style %}
  <style>
    #remove-item-form {
        display: inline;
    }
    #new-item-save {
        float: right;
    }
    #new-item-desc-wrapper {
        overflow: hidden;
        padding-right: .5em;
    }
    #new-item-desc {
        width: 100%;
    }
    .message {
        width: 100%;
    }
  </style>
{% endblock %}

{% block content %}
  <h1 class="text-center">Your Shopping Lists</h1>
    
  {% if not user_shopping_lists %}
    <div class="text-center">
      <br>
      <h3>
        Looks like you don't have any lists created.
      </h3>
    </div>
  {% else %}
    {% for list in user_shopping_lists %}
      <div id="{{ list.id }}" class="shopping-list well">
        <h1>
          <a href="/lists/{{ list.id }}/">
            {{ list }}&nbsp;&nbsp;&nbsp;
          </a>
        </h1>
        <h4>{{ list.description }}</h4>  
        <hr>
        {% if messages %}
          {% for message in messages %}
            {{ message.tags }}
            <!-- Only show messages that pertain to the list the operation was completed on -->
            {% ifequal message.extra_tags list.id %}
              <span>{{ message|safe }}</span>
              <br><br>
            {% endifequal %}
          {% endfor %}
        {% endif %}
        <table class="table table-borderless">
          <tbody>
            {% for item in list.items.all %}
              <tr class="shopping-list-row">
                <td>
                  <!-- Remove item form -->
                  <form method="POST" id="remove-item-form" action="{% url 'remove-item' %}">
                    {% csrf_token %}
                    <input type="hidden" value="{{ item.name }}" name="remove-item-name">
                    <input type="hidden" value="{{ item.description }}" name="remove-item-description">
                    <input type="hidden" value="{{ list.id }}" name="list-id">
                    <button type="submit" data-toggle="popover" data-placement="top" data-content="Remove this item from your list" class="btn btn-lg btn-danger fa fa-minus-square">&nbsp;from List</button>  
                  </form>
                  <!-- TODO: Add javascript to dynamically add form below this row's content that lets you add item to pantry
                             with all the extra fields that an ItemDetail has -->
                  <span data-toggle="popover" data-placement="top" data-content="Add this item to your pantry" class="btn btn-lg  btn-primary fa fa-plus-square">&nbsp;to Pantry</span>  
                  <h4>{{ item.name }}</h4>
                </td>
                <td>
                  <h6>{{ item.description }}</h6>
                </td>
              </tr>
            {% endfor %}
            <tr>
              <!-- add item form -->
              <form class="form-horizontal" id="new-item-form" action="{% url 'new-item' %}" method="POST">
                {% csrf_token %}
                <td>
                  <input type="text" class="form-control" name="new-item-name" id="new-item-name" placeholder="Item Name">
                </td>
                <td>
                  <input type="submit" class="btn btn-primary" value="Save" id="new-item-save" />
                  <div id="new-item-desc-wrapper">
                    <input type="text" class="form-control" name="new-item-description" id="new-item-desc" placeholder="Item Description" />
                  </div>
                  <input type="hidden" value="{{list.id}}" name="list-id">
                </td>
              </form>
            </tr>
          </tbody>              
        </table>            
  
        <!-- TODO: Add javascript to dynamically add form to add new items to the list -->
        <div class="text-center">
          <span class="btn btn-lg btn-primary text-center">Add Another Item</span>
        </div>
      </div>
    {% endfor %}
  {% endif %}
      
  <div class="text-center">
    <a href="{% url 'new-list' %}" class="btn btn-lg btn-primary">
      Create a New List
    </a>
  </div>

{% endblock %}

{% block script %}
  <script>
    $(document).ready(function(){
      $('[data-toggle="popover"]').popover({ trigger: "hover" }); 
    });
  </script>
{% endblock %}
